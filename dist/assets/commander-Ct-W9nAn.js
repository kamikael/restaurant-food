import{c as p,r as j,u as A,j as e}from"./index-Y1V_58Do.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],W=p("circle-check-big",U);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],O=p("lock",J);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],G=p("mail",D);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],H=p("phone",B);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Z=p("shield",X);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]],L=p("shopping-bag",K);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],E=p("user",Q);var k="clover",Y=function(r){return r===3?"v3":r},C="https://js.stripe.com",ee="".concat(C,"/").concat(k,"/stripe.js"),te=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,re=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var se=function(r){return te.test(r)||re.test(r)},ne=function(){for(var r=document.querySelectorAll('script[src^="'.concat(C,'"]')),t=0;t<r.length;t++){var a=r[t];if(se(a.src))return a}return null},$=function(r){var t="",a=document.createElement("script");a.src="".concat(ee).concat(t);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(a),a},ae=function(r,t){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"8.0.0",startTime:t})},g=null,b=null,y=null,ie=function(r){return function(t){r(new Error("Failed to load Stripe.js",{cause:t}))}},oe=function(r,t){return function(){window.Stripe?r(window.Stripe):t(new Error("Stripe.js not available"))}},le=function(r){return g!==null?g:(g=new Promise(function(t,a){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var i=ne();if(!(i&&r)){if(!i)i=$(r);else if(i&&y!==null&&b!==null){var m;i.removeEventListener("load",y),i.removeEventListener("error",b),(m=i.parentNode)===null||m===void 0||m.removeChild(i),i=$(r)}}y=oe(t,a),b=ie(a),i.addEventListener("load",y),i.addEventListener("error",b)}catch(d){a(d);return}}),g.catch(function(t){return g=null,Promise.reject(t)}))},ce=function(r,t,a){if(r===null)return null;var i=t[0],m=i.match(/^pk_test/),d=Y(r.version),l=k;m&&d!==l&&console.warn("Stripe.js@".concat(d," was loaded on the page, but @stripe/stripe-js@").concat("8.0.0"," expected Stripe.js@").concat(l,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var h=r.apply(void 0,t);return ae(h,a),h},v,R=!1,P=function(){return v||(v=le(null).catch(function(r){return v=null,Promise.reject(r)}),v)};Promise.resolve().then(function(){return P()}).catch(function(s){R||console.warn(s)});var de=function(){for(var r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];R=!0;var i=Date.now();return P().then(function(m){return ce(m,t,i)})};const me=de("pk_test_51SEY8MLlaBlntEPj6fnJIO3Ai6a5uok7rLT3Yz7eAhlDoGKJ0KC0ukxUsZl49Q7WqgjXtfSiV0gYEHxQ7WtRsQtE00NysOthpS");async function ue(s,r){try{if(!await me)throw new Error("Stripe n'a pas pu être initialisé");const i=`${s.items.map(l=>{const h=`${l.quantity}x ${l.name}`;return l.description?`${h} (${l.description})`:h}).join(", ")} | Livraison: ${s.delivery}€ | Réduction: ${s.discount}€`,m=await fetch("https://backend-restaurant-ml36.onrender.com/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totalAmount:s.total,quantity:s.totalItems,description:i,delivery:s.delivery,discount:s.discount,items:s.items.map(l=>({name:l.name,quantity:l.quantity,description:l.description||""})),customerEmail:r.email,customerName:r.fullName,customerPhone:r.phone,customerFirstName:r.firstName,customerLastName:r.lastName})});if(!m.ok){const l=await m.json().catch(()=>({}));throw new Error(l.message||"Impossible de créer la session de paiement")}const{url:d}=await m.json();if(!d)throw new Error("Aucune URL de session reçue du backend");window.location.href=d}catch(t){throw console.error("Erreur lors du checkout :",t),alert(t instanceof Error?t.message:"Une erreur est survenue. Veuillez réessayer."),t}}const he=()=>{const[s,r]=j.useState({firstName:"",lastName:"",email:"",phone:""}),[t,a]=j.useState({}),[i,m]=j.useState(""),[d,l]=j.useState(!1),{getCartSummary:h}=A(),u=h(),S=(c,o)=>{switch(c){case"firstName":case"lastName":return o.trim()?o.trim().length<2?`${c==="firstName"?"Le prénom":"Le nom"} doit contenir au moins 2 caractères`:/^[a-zA-ZÀ-ÿ\s'-]+$/.test(o)?void 0:"Seules les lettres, espaces, apostrophes et tirets sont autorisés":`${c==="firstName"?"Le prénom":"Le nom"} est requis`;case"email":return o.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?void 0:"Veuillez entrer une adresse email valide":"L'adresse email est requise";case"phone":if(!o.trim())return"Le numéro de téléphone est requis";const n=o.replace(/[\s\-().]/g,"");if(n.length<10)return"Le numéro doit contenir au moins 10 chiffres";if(n.length>15)return"Le numéro ne peut pas dépasser 15 chiffres";const w=/^(0[6-7]\d{8})$/,f=/^(0[1-5,9]\d{8})$/,V=/^\+33[1-9]\d{8}$/,F=/^\+[1-9]\d{8,14}$/,M=w.test(n),T=f.test(n),q=V.test(n),z=F.test(n);return!M&&!T&&!q&&!z?"Format invalide. Exemples: 06 12 34 56 78, +33 6 12 34 56 78":n.startsWith("0")&&(n.startsWith("00")||n.startsWith("08"))?"Numéro invalide. Utilisez un numéro mobile (06/07) ou fixe (01-05, 09)":void 0;default:return}},N=c=>{const{name:o,value:x}=c.target;let n=x;o==="firstName"||o==="lastName"?n=x.replace(/[^a-zA-ZÀ-ÿ\s'-]/g,""):o==="phone"?(n=x.replace(/[^\d\s\-+().]/g,""),n.startsWith("0")&&n.length===10?n=n.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5"):n.startsWith("+33")&&n.replace(/[\s\-().]/g,"").length===12&&(n=n.replace(/[\s\-().]/g,"").replace(/(\+33)(\d)(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5 $6"))):o==="email"&&(n=x.replace(/\s/g,"").toLowerCase()),r(f=>({...f,[o]:n}));const w=S(o,n);a(f=>({...f,[o]:w}))},_=()=>{const c={};let o=!0;return Object.keys(s).forEach(x=>{const n=S(x,s[x]);n&&(c[x]=n,o=!1)}),a(c),o},I=async()=>{if(_()){l(!0),m("");try{if(u.totalItems===0){a({email:"Votre panier est vide"}),l(!1);return}const c=s.phone.replace(/[\s\-().]/g,"");let o=c;c.startsWith("0")&&(o="+33"+c.substring(1));const x={firstName:s.firstName.trim(),lastName:s.lastName.trim(),email:s.email.trim().toLowerCase(),phone:o,fullName:`${s.firstName.trim()} ${s.lastName.trim()}`};await ue(u,x),console.log("Données envoyées:",{cartSummary:u,customerData:x}),m("✅ Redirection vers le paiement..."),setTimeout(()=>{r({firstName:"",lastName:"",email:"",phone:""})},1e3)}catch(c){a({email:"Une erreur est survenue. Veuillez réessayer."}),console.error("Erreur checkout:",c)}finally{l(!1)}}};return e.jsx("div",{className:"min-h-screen py-12 px-4 bg-gradient-to-br from-orange-50 via-white to-red-50",children:e.jsxs("div",{className:"container mx-auto max-w-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-100 rounded-full mb-4",children:e.jsx(L,{className:"h-8 w-8 text-orange-600"})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-2",children:"Finaliser ma commande"}),e.jsx("p",{className:"text-gray-600",children:"Remplissez vos informations pour continuer"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Résumé de la commande"}),e.jsxs("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:[u.totalItems," article",u.totalItems>1?"s":""]})]}),e.jsx("div",{className:"space-y-2 text-white/90",children:u.items.map((c,o)=>e.jsx("div",{className:"flex justify-between text-sm",children:e.jsxs("span",{children:[c.quantity,"x ",c.name]})},o))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/30",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total"}),e.jsxs("span",{className:"text-3xl font-bold",children:[u.total.toFixed(2),"€"]})]}),u.delivery>0&&e.jsxs("p",{className:"text-xs text-white/80 mt-1",children:["(incluant ",u.delivery.toFixed(2),"€ de livraison)"]}),u.discount>0&&e.jsxs("p",{className:"text-xs text-white/80",children:["Réduction appliquée : -",u.discount.toFixed(2),"€"]})]})]}),e.jsxs("div",{className:"p-8",children:[i&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-r-lg flex items-center",children:[e.jsx(W,{className:"h-5 w-5 text-green-500 mr-3"}),e.jsx("p",{className:"text-green-700 font-medium",children:i})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-gray-700 text-sm font-semibold mb-2",children:[e.jsx(E,{className:"h-5 w-5 mr-2 text-orange-500"}),"Prénom ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",name:"firstName",value:s.firstName,onChange:N,placeholder:"Jean",maxLength:50,className:`w-full py-3 px-4 border-2 rounded-xl text-gray-700 
                    focus:outline-none transition-all
                    ${t.firstName?"border-red-300 bg-red-50 focus:border-red-500":"border-gray-200 bg-gray-50 focus:border-orange-500"}
                    hover:border-orange-300`,disabled:d}),t.firstName&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"⚠️"})," ",t.firstName]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-gray-700 text-sm font-semibold mb-2",children:[e.jsx(E,{className:"h-5 w-5 mr-2 text-orange-500"}),"Nom ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"text",name:"lastName",value:s.lastName,onChange:N,placeholder:"Dupont",maxLength:50,className:`w-full py-3 px-4 border-2 rounded-xl text-gray-700 
                    focus:outline-none transition-all
                    ${t.lastName?"border-red-300 bg-red-50 focus:border-red-500":"border-gray-200 bg-gray-50 focus:border-orange-500"}
                    hover:border-orange-300`,disabled:d}),t.lastName&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"⚠️"})," ",t.lastName]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-gray-700 text-sm font-semibold mb-2",children:[e.jsx(G,{className:"h-5 w-5 mr-2 text-orange-500"}),"Adresse email ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:N,placeholder:"votre.email@exemple.com",maxLength:100,className:`w-full py-3 px-4 border-2 rounded-xl text-gray-700 
                    focus:outline-none transition-all
                    ${t.email?"border-red-300 bg-red-50 focus:border-red-500":"border-gray-200 bg-gray-50 focus:border-orange-500"}
                    hover:border-orange-300`,disabled:d}),t.email&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"⚠️"})," ",t.email]}),!t.email&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"📧 Confirmation de commande envoyée à cette adresse"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-gray-700 text-sm font-semibold mb-2",children:[e.jsx(H,{className:"h-5 w-5 mr-2 text-orange-500"}),"Numéro de téléphone ",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:N,placeholder:"06 12 34 56 78 ou +33 6 12 34 56 78",maxLength:20,className:`w-full py-3 px-4 border-2 rounded-xl text-gray-700 
                    focus:outline-none transition-all
                    ${t.phone?"border-red-300 bg-red-50 focus:border-red-500":"border-gray-200 bg-gray-50 focus:border-orange-500"}
                    hover:border-orange-300`,disabled:d}),t.phone&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"⚠️"})," ",t.phone]}),!t.phone&&s.phone&&e.jsxs("p",{className:"text-xs text-green-600 mt-2 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"✓"})," Numéro valide"]}),!t.phone&&!s.phone&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"📱 Mobile (06/07) ou fixe (01-05/09) • Format international accepté"})]})]}),e.jsx("button",{onClick:I,disabled:d||u.totalItems===0,className:`w-full mt-8 py-4 px-6 rounded-xl font-bold text-lg
                transition-all duration-300 transform
                ${d||u.totalItems===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600 hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]"}
                flex items-center justify-center space-x-2`,children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Traitement en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-6 w-6"}),e.jsxs("span",{children:["Commander ",u.total.toFixed(2),"€"]})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-center space-x-6 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-1 text-green-500"}),"Paiement sécurisé"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-1 text-blue-500"}),"Données protégées"]})]})]})]}),e.jsxs("div",{className:"text-center mt-8 text-sm text-gray-600",children:[e.jsxs("p",{children:["🍽️ ",e.jsx("strong",{children:"Mama Food's"})," - Cuisine africaine authentique"]}),e.jsx("p",{className:"mt-2",children:"Livraison gratuite • Paiement sécurisé par Stripe"})]})]})})};export{he as default};
